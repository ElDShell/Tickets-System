{% extends "main.html" %}

{% block title %}Dashboard{% endblock title %}

{% block content %}
<main class="h-full">
    <div class="grid h-full mb-4 pb-10 px-8 mx-4 rounded-3xl bg-gray-100 border-4 border-green-400">

      <div class="grid h-full grid-cols-12 gap-6">
        <div class="grid grid-cols-12 col-span-12 gap-6 xxl:col-span-9">
          <div class="col-span-12 mt-8">
            <div class="flex items-center h-10 intro-y">
              <h2 class="mr-5 text-lg font-medium truncate">Dashboard</h2>
            </div>
            <div class="grid grid-cols-12 gap-6 mt-5">
              <!-- Card -->
              <a class="transform  hover:scale-105 transition duration-300 shadow-xl rounded-lg col-span-12 sm:col-span-6 xl:col-span-3 intro-y bg-white">
                <div class="p-5">
                  <div class="flex justify-between">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 text-green-500">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"></path>
                    </svg>
                  </div>
                  <div class="ml-2 w-full flex-1">
                    <div>
                      <div class="mt-3 text-3xl font-bold leading-8">{{all_tickets}}</div>

                      <div class="mt-1 text-base text-gray-600">
                        {% if request.user.is_admin %}
                          All Tickets
                        {% elif request.user.is_customer %}
                          My Tickets
                        {% endif %}
                        </div>
                    </div>
                  </div>
                </div>
              </a>
              <a class="transform  hover:scale-105 transition duration-300 shadow-xl rounded-lg col-span-12 sm:col-span-6 xl:col-span-3 intro-y bg-white">
                <div class="p-5">
                  <div class="flex justify-between">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-green-500" fill="none"
                      viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                  <div class="ml-2 w-full flex-1">
                    <div>
                      <div class="mt-3 text-3xl font-bold leading-8">{{all_active_tickets}}</div>

                      <div class="mt-1 text-base text-gray-600">Active Tickets</div>
                    </div>
                  </div>
                </div>
              </a>
              <a class="transform  hover:scale-105 transition duration-300 shadow-xl rounded-lg col-span-12 sm:col-span-6 xl:col-span-3 intro-y bg-white">
                <div class="p-5">
                  <div class="flex justify-between">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 text-red-500">
                      <path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                  </div>
                  <div class="ml-2 w-full flex-1">
                    <div>
                      <div class="mt-3 text-3xl font-bold leading-8">{{all_closed_tickets}}</div>

                      <div class="mt-1 text-base text-gray-600">Closed Tickets</div>
                    </div>
                  </div>
                </div>
              </a>
              <a class="transform  hover:scale-105 transition duration-300 shadow-xl rounded-lg col-span-12 sm:col-span-6 xl:col-span-3 intro-y bg-white">
                <div class="p-5">
                  <div class="flex justify-between">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-yellow-400" fill="none"
                      viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
                    </svg>
                  </div>
                  <div class="ml-2 w-full flex-1">
                    <div>
                      <div class="mt-3 text-3xl font-bold leading-8">{{all_pending_tickets}}</div>
                      <div class="mt-1 text-base text-gray-600">Pending Tickets</div>
                    </div>
                  </div>
                </div>
              </a>
            </div>
          </div>
          {% comment %} <div class="col-span-12 mt-5">
            <div class="grid gap-2 grid-cols-1 lg:grid-cols-2">
              <div class="bg-white shadow-lg p-4" id="chartline"></div>
              <div class="bg-white shadow-lg" id="chartpie"></div>
            </div>
          </div>  {% endcomment %}
          <div class="h-full col-span-12">
            <div class="grid gap-2 grid-cols-1 lg:grid-cols-1">
              <div class="bg-white p-4 shadow-lg rounded-lg">
                <h1 class="font-bold text-base">New Tickets</h1>
                <div class="mt-4">
                  <div class="flex flex-col">
                    <div class="-my-2 overflow-x-auto">
                      <div class="py-2 align-middle inline-block min-w-full">
                        <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg bg-white">
                            <table class="min-w-full divide-y divide-gray-200">
                              <thead>
                                <tr>
                                  <th
                                    class="px-6 py-3 bg-gray-50 text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">
                                    <div class="flex cursor-pointer">
                                      <span class="mr-2">Ticket Number</span>
                                    </div>
                                  </th>
                                  <th
                                    class="px-6 py-3 bg-gray-50 text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">
                                    <div class="flex cursor-pointer">
                                      <span class="mr-2">Title</span>
                                    </div>
                                  </th>
                                  <th
                                    class="px-6 py-3 bg-gray-50 text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">
                                    <div class="flex cursor-pointer">
                                      <span class="mr-2">Created On</span>
                                    </div>
                                  </th>
                                  {% if request.user.is_customer %}
                                  <th
                                    class="px-6 py-3 bg-gray-50 text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">
                                    <div class="flex cursor-pointer">
                                      <span class="mr-2">Assigned By</span>
                                    </div>
                                  </th>
                                  {% endif %}
                                  {% if request.user.is_admin %}
                                    <th
                                      class="px-6 py-3 bg-gray-50 text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">
                                      <div class="flex cursor-pointer">
                                        <span class="mr-2">Created By</span>
                                      </div>
                                    </th>
                                  {% endif %}
                                  <th
                                    class="px-6 py-3 bg-gray-50 text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">
                                    <div class="flex cursor-pointer">
                                      <span class="mr-2">STATUS</span>
                                    </div>
                                  </th>
                                  <th
                                    class="px-6 py-3 bg-gray-50 text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider">
                                    <div class="flex cursor-pointer">
                                      <span class="mr-2">ACTION</span>
                                    </div>
                                  </th>
                                </tr>
                              </thead>
                              <tbody class="bg-white divide-y divide-gray-200">
                                {% for t in table_tickets %}
                                <tr>
                                  <td class="px-6 py-4 whitespace-no-wrap text-md leading-5">
                                    <p>{{t.number}}</p>
                                  </td>
                                  <td class="px-6 py-4 whitespace-no-wrap text-md leading-5">
                                    <h3>{{t.title|title}}</h3>
                                  </td>
                                  <td class="px-6 py-4 whitespace-no-wrap text-md leading-5">
                                    <p>{{t.created_at|date:'d/m/Y'}}</p>
                                  </td>
                                  {% if request.user.is_customer %}
                                    <td class="px-6 py-4 whitespace-no-wrap text-md leading-5">
                                      <p>{{t.assigned_to}}</p>
                                    </td>
                                  {% endif %}
                                  {% if request.user.is_admin %}
                                    <td class="px-6 py-4 whitespace-no-wrap text-md leading-5">
                                      <p>{{t.created_by.username}}</p>
                                    </td>
                                  {% endif %}
                                  <td class="px-6 py-4 whitespace-no-wrap text-md leading-5">
                                    {% if t.status == 'Active' %}
                                      <div class="flex text-green-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-1" fill="none"
                                          viewBox="0 0 24 24" stroke="currentColor">
                                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        <p>Active</p>
                                      </div>
                                    {% elif t.status == 'Pending' %}
                                      <div class="flex text-yellow-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-1 text-yellow-400">
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0M10.5 8.25h3l-3 4.5h3"></path>
                                        </svg>
                                        <p>Pending</p>
                                      </div>
                                    {% elif t.status == 'Complated' %}
                                    <div class="flex text-red-500">
                                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-1">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"></path>
                                      </svg>
                                      <p>Completed</p>
                                    </div>
                                    {% endif %}
                                  </td>
                                  <td class="px-6 py-4 whitespace-no-wrap text-sm leading-5">
                                    <div class="flex space-x-4">
                                    {% if request.user.is_customer and not t.is_resolved %}
                                        <a href="{% url 'update_ticket' t.id %}" class="text-blue-500 hover:text-blue-600">
                                          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-1" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                          </svg>
                                          <p>Edit</p>
                                        </a>
                                      {% endif %}
                                      <!-- Delete Link -->
                                      <a href="#" class="text-red-500 hover:text-red-600" onclick="openModal('{{ ticket.id }}')">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-1 ml-3" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                        <p>Delete</p>
                                      </a>

                                      <div id="deleteModal" class="modal" style="display:none;">
                                        <div class="modal-content">
                                            <span class="close" onclick="closeModal()">&times;</span>
                                            <p class="modal-message"><b>Are you sure you want to delete this ticket?</b></p>
                                            <form method='POST' id="deleteTicketForm" action="{% url 'delete_ticket' t.id %}">
                                                {% csrf_token %}
                                                <button type="submit" id="confirmDeleteButton" class="btn-delete">Yes, delete it</button>
                                                <button type="button" onclick="closeModal()" class="btn-cancel">Cancel</button> <!-- Set type to button -->
                                            </form>
                                        </div>
                                    </div>                                    
                                      <script>
                                        let ticketIdToDelete = null;

                                        function openModal(ticketId) {
                                            ticketIdToDelete = ticketId; // Store the ticket ID to delete
                                            document.getElementById("deleteModal").style.display = "block"; // Show the modal
                                        }

                                        function closeModal() {
                                            document.getElementById("deleteModal").style.display = "none"; // Hide the modal
                                        }

                                        document.getElementById("confirmDeleteButton").onclick = function() {
                                            if (ticketIdToDelete) {
                                                window.location.href = "#".replace('0', ticketIdToDelete); // Redirect to delete
                                            }
                                        }
                                      </script>

                                      <style>
                                        /* Basic styles for the modal */
                                        .modal {
                                            display: flex;
                                            position: fixed;
                                            z-index: 1;
                                            left: 0;
                                            top: 0;
                                            width: 100%;
                                            height: 100%;
                                            overflow: auto;
                                            background-color: rgb(0, 0, 0);
                                            background-color: rgba(0, 0, 0, 0.4);
                                        }

                                        .modal-content {
                                            background-color: #fefefe;
                                            margin: 15% auto;
                                            padding: 20px;
                                            border: 1px solid #888;
                                            width: 80%;
                                            max-width: 500px;
                                            text-align: center; 
                                        }
                                        
                                        .modal-message {
                                          margin-bottom: 20px; /* Space between the message and buttons */
                                       }
                                        .close {
                                            color: #aaa;
                                            float: right;
                                            font-size: 28px;
                                            font-weight: bold;
                                        }

                                        .close:hover,
                                        .close:focus {
                                            color: black;
                                            text-decoration: none;
                                            cursor: pointer;
                                        }
                                        .btn-delete {
                                          background-color: #dc2626; /* Red background */
                                          color: white; /* White text */
                                          border: none; /* No border */
                                          padding: 10px 20px; /* Padding for better appearance */
                                          border-radius: 5px; /* Rounded corners */
                                          cursor: pointer; /* Pointer cursor on hover */
                                          font-size: 16px; /* Font size */
                                          margin-right: 10px; 
                                      }
                                      
                                      .btn-delete:hover {
                                          background-color: #b91c1c; /* Darker red on hover */
                                      }
                                      
                                      .btn-cancel {
                                          background-color: #d1d5db; /* Gray background */
                                          color: black; /* Black text */
                                          border: none; /* No border */
                                          padding: 10px 20px; /* Padding for better appearance */
                                          border-radius: 5px; /* Rounded corners */
                                          cursor: pointer; /* Pointer cursor on hover */
                                          font-size: 16px; /* Font size */
                                      }
                                      
                                      .btn-cancel:hover {
                                          background-color: #9ca3af; /* Darker gray on hover */
                                      }
                                      </style>

                                    </div>
                                  </td>
                                </tr>
                                {% endfor %}

                              </tbody>
                            </table>
                         
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
{% endblock content %}